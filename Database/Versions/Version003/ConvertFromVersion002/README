
To update a version 2 anatomy database to a version 3 anatomy
database, do these steps:

1. Apply the schemaPre.sql script to your database.
2. Apply the controlScript.sql script to your database.
3. Apply the schemaPost.sql script to your database.


---------------------------------------------------------------------

This is a unique anatomy DB version conversion directory.  The files in
this directory are usually created by a single run of the CIOF
translator.

Version 3 of the anatomy database features some twists.  In addition
to processing updates from the latest CIOF, this update adds ordering
information to the sibling terms.  However, the code to do this is not
part of CiofTranslation, but is under DisplayOrder.  The display order
information (SQL) can be found in this directory in
orderingUpdates.sql.  controlScript.sql has been manually updated to
run this foreign script.

However, the work done by the DisplayOrder script affects what goes in
ANAD_PART_OF, which is generated by CiofTranslation.  It is almost a
chicken-egg problem.

To produce The files in this directory this recipe was followed

1. Run the (old) CIOF translator
2. Apply the files from the CIOF translator to the DB
3. Run the DisplayOrder script to generate orderingUpdates.sql
4. Run orderingUpdates.sql against the DB.
5. Rerun the CIOF translator.
6. Place these files in this directory:
   o The SQL files from 1.
   o The orderingUpdates.sql file from 3.
   o The ANAD_PART_OF.inserts.sql file from 5.
7. Update controlScript.sql to run orderingUpdates.sql, right at the
   end.

I then checked everything into CVS to avoid inadvertently losing the
files. 

The scripts in the resulting directory (this directory) can then be
applied (along with the pre and post schema change scripts to any
Version 2 anatomy database to convert it to a Version 3 anatomy
database.

NOTE: The CIOF translator has since been updated.  It no longer
      processes the relationship ordering data or regenerates the
      derived data.  The process described above was just too darn
      painful. 


----------------------------------------------------------------

20 Nov 2006 Addendum

Version 3 of the Anatomy database was deployed to the production
GUDMAP database on 15 Nov 2006.

However, in a comedy of errors (although it didn't actually seem funny
at the time) the order established by the first orderingUpdates.sql
was completely (can I stress completely?) wrong.  This was discovered
by Jamie on th 16th, and after 2 days of wild scrambling was fixed on
the 17th.  See patchUp.sql for exactly what was run on the 17th.

All of the above description is still accurate, and to update a
version 2 DB to version 3, all you need do is run controlScript.sql.

-----------------------------------------------------------------

03 Sep 2007 Addendum

OK, almost a year later, it's funny.  Almost.
